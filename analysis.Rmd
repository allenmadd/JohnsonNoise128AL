---
title: "Johnson Noise 128AL"
author: "Madeleine Allen, Edward Piper"
date: "1/31/2019"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Analysis: Step 1: g(f)

Make sure that the data is in the same folder as the R-script (should be automatic if you clone the git repo) (btw I hate myself for saying "clone the git repo")

Plots to verify what the data looks like.
```{r}
vin1<-read.csv("/Users/mallen/Documents/128AL/JohnsonNoise128AL/VIN1.CSV")

names(vin1)<-c("x", "y")
plot(vin1$x)
plot(vin1$y)

```

Now I'll upload the rest of the data. I'll plot an out graph for reference too.
```{r}
vin2<-read.csv("/Users/mallen/Documents/128AL/JohnsonNoise128AL/VIN2.CSV")
names(vin2)<-c("x", "y")

vin3<-read.csv("/Users/mallen/Documents/128AL/JohnsonNoise128AL/VIN3.CSV")
names(vin3)<-c("x", "y")
vin4<-read.csv("/Users/mallen/Documents/128AL/JohnsonNoise128AL/VIN4.CSV")
names(vin4)<-c("x", "y")
vin5<-read.csv("/Users/mallen/Documents/128AL/JohnsonNoise128AL/VIN5.CSV")
names(vin5)<-c("x", "y")

vout1<-read.csv("/Users/mallen/Documents/128AL/JohnsonNoise128AL/VOUT1.CSV")
names(vout1)<-c("x", "y")
vout2<-read.csv("/Users/mallen/Documents/128AL/JohnsonNoise128AL/VOUT2.CSV")
names(vout2)<-c("x", "y")
vout3<-read.csv("/Users/mallen/Documents/128AL/JohnsonNoise128AL/VOUT3.CSV")
names(vout3)<-c("x", "y")
vout4<-read.csv("/Users/mallen/Documents/128AL/JohnsonNoise128AL/VOUT4.CSV")
names(vout4)<-c("x", "y")
vout5<-read.csv("/Users/mallen/Documents/128AL/JohnsonNoise128AL/VOUT5.CSV")
names(vout5)<-c("x", "y")
plot(vout5$y)
```

Find the mean of each value:
It should be noted that the vin voltages are flat whereas the vout voltages are peaked, so only the peak region is selected (thus the ranges present in the y values for the vout values)
```{r}
m_vin1<-mean(vin1$y)
m_vin2<-mean(vin2$y)
m_vin3<-mean(vin3$y)
m_vin4<-mean(vin4$y)
m_vin5<-mean(vin5$y)

m_in<- mean(m_vin1, m_vin2, m_vin3, m_vin4, m_vin5)

m_vout1<-mean(vout1$y[35:44])
m_vout2<-mean(vout2$y[37:54])
m_vout3<-mean(vout3$y[35:56])
m_vout4<-mean(vout4$y[35:53])
m_vout5<-mean(vout5$y[35:52])

m_out<- mean(m_vout1, m_vout2, m_vout3, m_vout4, m_vout5)

```

Now we have the mean in and the mean out so we can find the gain:
```{r}
gF<- m_out/m_in
print(gF)
```

Now to calculate the errors for each measurement (which will be propagated into the final error for the gain):
```{r}
vin1_error<- sd(vin1$y, na.rm=TRUE)/sqrt(length(vin1$y[!is.na(vin1$y)]))
vin2_error<-sd(vin2$y, na.rm=TRUE)/sqrt(length(vin2$y[!is.na(vin2$y)]))
vin3_error<- sd(vin3$y, na.rm=TRUE)/sqrt(length(vin3$y[!is.na(vin3$y)]))
vin4_error<- sd(vin4$y, na.rm=TRUE)/sqrt(length(vin4$y[!is.na(vin4$y)]))
vin5_error<- sd(vin5$y, na.rm=TRUE)/sqrt(length(vin5$y[!is.na(vin5$y)]))

vout1_error<-sd(vout1$y[35:44], na.rm=TRUE)/sqrt(length(vout1$y[!is.na(vout1$y)]))
vout2_error<- sd(vout2$y[37:54], na.rm=TRUE)/sqrt(length(vout2$y[!is.na(vout2$y)]))
vout3_error<- sd(vout3$y[36:56], na.rm=TRUE)/sqrt(length(vout3$y[!is.na(vout3$y)]))
vout4_error<- sd(vout4$y[35:53], na.rm=TRUE)/sqrt(length(vout4$y[!is.na(vout4$y)]))
vout5_error<- sd(vout5$y[35:53], na.rm=TRUE)/sqrt(length(vout5$y[!is.na(vout5$y)]))
```

Now we have errors for every measurement. The averages used to calculate gain need errors too.
```{r}
m_vin_error <- sqrt(vin1_error^2+vin2_error^2 + vin3_error^2+ vin4_error^2+vin5_error^2)
m_vout_error <- sqrt(vout1_error^2+vout2_error^2 + vout3_error^2+ vout4_error^2+vout5_error^2)
```
Now we can find the error in the gain function from the error in Vin and Vout
```{r}
gF_error<-sqrt(m_vin_error^2 +m_vout_error^2)
print(gF_error)
#seems a little small. not sure if I did it right then?
```

Graph g(f) against frequency
```{r}
gF_list= vector()
for (i in 1:length(vin1$x))
{
  mean_vin = mean(vin1$y[i], vin2$y[i], vin3$y[i], vin4$y[i], vin5$y[i])
  mean_vout= mean(vout1$y[i], vout2$y[i], vout3$y[i], vout4$y[i], vout5$y[i])
  gF_list[i]=mean_vout/mean_vin
}
plot(vin1$x, gF_list) #is this what they mean by plot? Is this what it should look like?
```

## Analysis Step 2: Johnson Noise 1
Recording the resistor values measured during lab.
```{r}
#everything will be in ohms 
short<- .03
shortError<-.001

k20<-20090
k20error<-1

k35 <- 35230 #secretly 35.2 but that would be an ugly variable name
k35error<-1

k100 <- 100700
k100error <- 1

k10 <- 999.05
k10error<- .01

k1 <- 998.17
k1error <- .01

k48 <- 48650 #secretly 48.7k but again that would be an ugly variable name
k48error<- 1
```

Capacitance for the circuit.
```{r}
capacitance <-87.875
capacitanceError <-.594
```

Import measurements from experiment 2
```{r}
experiment2data<-read.csv("/Users/mallen/Documents/128AL/JohnsonNoise128AL/experiment2data1.csv")

#View(experiment2data)
```

Calculate Vmeas
```{r}
Vsys<- experiment2data[1,7] #first row 7th column
VsysError <- experiment2data[1,9]

Vmeask1<- (experiment2data[2,7])
Vmeask10<-experiment2data[3,7]
Vmeask20 <-experiment2data[4,7]
Vmeask32<-experiment2data[5,7]
Vmeask48<-experiment2data[6,7]
Vmeask100<-experiment2data[7,7]

Vmeas<-c(Vmeask1, Vmeask10, Vmeask20, Vmeask32, Vmeask48, Vmeask100)

#need to redo the error later (2/5)
VmeasError<-sqrt((sum(experiment2data[2:7,9])^2))

V<- sqrt(-Vsys^2+Vmeas^2)
Verror<- sqrt(VmeasError^2+ VsysError^2)
```


###Edward Stuff

Calculate a value for G
Find the mean of each value:
It should be noted that the vin voltages are flat whereas the vout voltages are peaked, so dont just take average
```{r}
m_in<- (vin1$y+vin2$y+vin3$y+vin4$y+vin5$y)/5
#take average of vouts
m_vout <- data.frame(Frequency = vout1$x, Volts = (vout1$y+vout2$y+vout3$y+vout4$y+vout5$y)/5)
```

Now we have the mean in and the mean out so we can find the gain:
```{r}
#compute gain using the average vouts and m_in
gain <- data.frame(Frequency = vout1$x, Gain = (m_vout[2]/m_in))
plot(gain)
#this is consistent with the max gain of 150 calculated in class.
```


#Calculating Error
not really sure how to calculate error of a function. going to take RMSE for each.
```{r}
rmserrors <- sqrt(data.frame(
  vin1 = sum(((m_in-vin1$y)^2))/399, 
  vin2 = sum(((m_in-vin2$y)^2))/399,
  vin3 = sum(((m_in-vin3$y)^2))/399,
  vin4 = sum(((m_in-vin4$y)^2))/399,
  vin5 = sum(((m_in-vin5$y)^2))/399,
  vout1 = sum((m_vout$Volts-vout1$y)^2)/399,
  vout2 = sum((m_vout$Volts-vout2$y)^2)/399,
  vout3 = sum((m_vout$Volts-vout3$y)^2)/399,
  vout4 = sum((m_vout$Volts-vout4$y)^2)/399,
  vout5 = sum((m_vout$Volts-vout5$y)^2)/399
))
#error in gain, adding in quadrature: 
vinerror <-sqrt(sum(rmserrors[1:5]^2))
vouterror <- sqrt(sum(rmserrors[6:10]^2))
gainerror <- gain[2]*sqrt((vinerror/m_in)^2+(vouterror*(m_vout[2])^-1)^2)
#g(f) error
plot(1:399,unlist(gainerror[1]))
```
#Calculating G

```{r}
capacitance <-87.875*(10^-12)
capacitanceError <-.594*(10^-12)
#df is just the x componenent

riemanSum <- function(fa,fb){
  area <-0.5*(125)*(fb-fa)+fa*125
  return(area)
}

resistors<-read.csv("experiment2data1.csv")

C = capacitance
integrand <- data.frame(
  gain[2]/(1+(2*pi*C*vin1$x*short)^2),
  gain[2]/(1+(2*pi*C*vin1$x*k1)^2),
  gain[2]/(1+(2*pi*C*vin1$x*k10)^2),
  gain[2]/(1+(2*pi*C*vin1$x*k20)^2),
  gain[2]/(1+(2*pi*C*vin1$x*k35)^2),
  gain[2]/(1+(2*pi*C*vin1$x*k48)^2),
  gain[2]/(1+(2*pi*C*vin1$x*k100)^2)
  )
area <- data.frame(
  G1 =0,
  G2 =0,
  G3 =0,
  G4 =0,
  G5 =0,
  G6 =0,
  G7 =0
  
  )
for(i in 1:length(integrand))
{
    for(l in 1:398)
    {
      if(is.na(integrand[l+1,i]))
      {
        break
      }
      else
      {
        area[i] <- area[i]+ riemanSum(integrand[l,i],integrand[l+1,i])
      }
    }
}

```

So this returns a gain value G for each resistor 

```{r}
resistors<-c(0,1000,10000,20000,32500, 48700,100000)
plot(resistors,area, main= "Resistor value vs G", ylab = "Values of G", xlab = "Resistor Values (Ohm)")
```
#Plotting R as a function of V^2, kB, and G

IM VERY CONUFSED. I HAVE 4 GRAPHS HERE BECAUSE IM NOT SURE WHAT GOES ON THE Y AXIS AND WHAT KIND OF FIT LINE WE NEED SO I HAVE ALL 4 COMBOS (Y AND X SWITCHED AND EACH OF A LINEAR OR POLYNOMIAL FIT LINE)
```{r}
kb<- 1.38064852 *10^-23 #m2 kg s-2 K-1

area2<-area[2:7] #take away the short's data
y_value<- (V^2)/(4*kb*area2) #area is the vector that contains all G's
  #v^2 

#prepare data for graphing
resistors2 <-resistors[2:7] #take away the short
y<- unlist(y_value, use.names=FALSE)

#this is the data with resistor as the x axis and the other term as the x axis. I didd this because I wasnt sure what to do honestly.
fit  <- lm(y~resistors2)
plot(resistors2,y_value, main= "Resistance as a function of Gain and Voltage with a 1D Fit", xlab= "Resistance", ylab = "V^2/ (4*kb*G)")
lines(resistors2, predict(fit, data.frame(resistors2)), col="red")
legend("topleft", legend=c("Fit Line"),
       col=c("red"), lty=1:2, cex=0.8)

summary(fit)
plot(fit$residuals, main = "Residuals of the fit line", ylab= "Residuals")

plot(y, resistors2, main="Plot of Gain and Voltage as a function of Resistance with a 1D Fit")
fit  <- lm(resistors2~y)
lines(y, predict(fit,data.frame(y)),col="pink")
legend("topleft", legend=c("Fit Line"),
       col=c("pink"), lty=1:2, cex=0.8)
summary(fit)
plot(fit$residuals, main = "Residuals of the fit line", ylab= "Residuals")

```
So that gave us a giant value so I'm gonna try again

```{r}

fit2 <- lm(y~poly(resistors2,2,raw=TRUE))

#plot same as above this time with a 2d fit line
plot(resistors2,y_value, main= "Gain and Voltage as a function of Resistance with a 2nd order fit", ylab= "V^2/ (4*kb*G)", xlab = "Resistance")
lines(resistors2, predict(fit2, data.frame(resistors2)), col="blue")
legend("topleft", legend=c("Polynomial Fit Line"),
       col=c("blue"), lty=1:2, cex=0.8)

summary(fit2)
plot(fit2$residuals, main = "Residuals of the fit line", ylab= "Residuals")


#plot with switched variables and a 2d fitl ine 
fit2 <- lm(y~poly(y,2,raw=TRUE))
plot(y, resistors2, main= "Gain and Voltage as a function of Resistance with a 2nd order fit")
lines(y, predict(fit2, data.frame(y)), col="orange")
legend("topleft", legend=c("Polynomial Fit Line"),
       col=c("orange"), lty=1:2, cex=0.8)
summary(fit2)
plot(fit2$residuals, main = "Residuals of the fit line", ylab= "Residuals")


```
I'm not getting data that makes sense. Please h e l p.


#Experiment 3: Johnson Noise at Aboslute 0
```{r}



```

